# Docker Compose file Reference (https://docs.docker.com/compose/compose-file/)
version: '3.4'

#Define services
services:

  #MySQL Database for the application
  db:
    image: mysql:5.7.22
    command: mysqld --default-authentication-plugin=mysql_native_password
    restart: always
    environment: 
      TZ: America/Sao_Paulo
      MYSQL_ROOT_PASSWORD: docker
      MYSQL_USER: docker
      MYSQL_PASSWORD: docker
      MYSQL_DATABASE: loja_db
    ports:
      - "3306:3306" # Forward the exposed port 3306 on the container to port 3306 on the host machine
    networks:
      - loja-network 

  #Back-end Spring Boot Application
  app-server:
    #The docker file in app-server build the jar and provides the docker image with the following name.
    image: leandropldev/loja-server
    restart: always
    build: ./app-server
    working_dir: /app-server/app-loja
    #Environment variables for Spring Boot Application.
    environment: 
      TZ: America/Sao_Paulo
      SPRING_ENVIRONMENT: prod
      MYSQL_PASSWORD: docker
      MYSQL_DATABASE: loja_db
    ports:
      - "8080:8080" # Forward the exposed port 8080 on the container to port 8080 on the host machine
    command: mvn spring-boot:run
    links: 
      - db
    depends_on: 
      - db
    networks:
      - loja-network 
      
  #Fron-end Angular Application
  #app-client:
  #  build: ./app-client
  #  container_name: app-client
  #  ports:
  #    - 4200:80
  #  links:
  #    - app-server

networks: 
  loja-network:
    driver: bridge

#Volumes for DB data
volumes:
  project-data: